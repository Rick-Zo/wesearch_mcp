# 产品需求文档 (PRD)
# 微信公众号文章搜索与总结 MCP v2.0

**文档版本**: 2.0  
**创建日期**: 2025年11月5日  
**最后更新**: 2025年11月5日  
**产品负责人**: [待填写]  
**开发团队**: [待填写]

---

## 1. 产品概述

### 1.1 产品定位
微信公众号文章搜索 MCP 是一款基于 Model Context Protocol (MCP) 的数据获取工具,负责搜索和抓取微信公众号文章内容,并将原文提供给调用的 LLM 进行智能分析和总结。

### 1.2 产品目标
- 提供高效的微信公众号文章搜索和内容抓取能力
- 将完整文章内容返回给调用的 LLM,由 LLM 进行智能分析和总结
- 降低用户信息获取成本,与任何 LLM 无缝集成
- 职责清晰:MCP 负责数据获取,LLM 负责内容理解和总结

### 1.3 目标用户
- 内容研究者:需要快速调研特定主题在微信生态的讨论情况
- 行业分析师:需要追踪行业动态和舆情变化
- 知识工作者:希望高效发现和整理优质内容

---

## 2. 核心功能需求

### 2.1 功能列表

#### P0 (必须有)

**F1: 关键词搜索**
- 接收搜索关键词或自然语言查询
- 直接使用查询内容在搜狗微信搜索
- 支持中文关键词搜索

**F2: 微信文章搜索**
- 基于搜狗微信搜索引擎进行文章查询
- 默认返回前 3 篇相关文章
- 支持用户配置文章获取数量(1-10篇)

**F3: 批量内容抓取**
- 并发获取多篇文章的完整内容
- 解析文章标题、正文、公众号名称、摘要等元数据
- 获取文章真实 URL(非搜狗跳转链接)

**F4: 完整内容返回**
- 返回所有文章的完整正文内容
- 提供结构化的文章信息
- 每篇文章包含:公众号名、标题、链接、完整正文
- 由调用的 LLM 根据用户需求进行总结和分析

**F5: 结果输出**
- 以 Markdown 格式输出结果
- 包含搜索元数据和所有文章完整内容
- 保留原文链接便于用户访问

#### P1 (应该有)

**F6: 错误处理**
- 当搜索无结果时给出明确提示
- 网络超时时自动重试
- 解析失败时返回可读的错误信息

**F7: 性能优化**
- 限制并发请求数量(建议 ≤3)
- 设置请求超时时间(30秒)
- 对超长文章进行智能截断(10000字符)
- 返回完整内容供 LLM 处理

#### P2 (最好有)

**F8: 结果缓存**
- 对相同关键词的搜索结果进行缓存
- 缓存有效期可配置

**F9: 结果排序**
- 根据文章质量指标(阅读量、发布时间等)排序
- 支持用户自定义排序规则

**F10: 时间过滤**
- 支持指定文章发布时间范围
- 如"最近一周"、"最近一个月"等

---

## 3. 用户场景

### 3.1 场景一:快速主题调研
**角色**: 内容研究者 Alice  
**目标**: 了解"人工智能在医疗领域的应用"相关讨论  
**操作流程**:
1. Alice 在 Claude for Desktop 中输入:"帮我搜索关于人工智能在医疗领域应用的微信文章并总结"
2. Claude 调用 MCP 工具 `search_wechat_articles("人工智能 医疗", count=3)`
3. MCP 返回 3 篇文章的完整内容
4. Claude 自动分析所有文章内容,生成综合总结
5. Alice 获得总结和文章列表,可以追问细节或点击链接深度阅读

**预期结果**: 5 分钟内完成主题概览,Claude 可根据问题灵活调整总结角度

### 3.2 场景二:舆情监控
**角色**: 行业分析师 Bob  
**目标**: 追踪"区块链技术"相关的最新动态  
**操作流程**:
1. Bob 输入:"搜索关于'区块链技术'的微信文章,获取 5 篇,并从监管角度分析"
2. MCP 返回 5 篇文章的完整内容
3. Claude 从监管角度分析并生成报告
4. Bob 将结果保存到笔记中作为周报素材

**预期结果**: 快速获取多维度信息,LLM 可根据不同分析角度灵活输出

### 3.3 场景三:对比分析
**角色**: 知识工作者 Carol  
**目标**: 对比不同公众号对同一话题的观点  
**操作流程**:
1. Carol 输入:"搜索关于大模型应用的文章,对比不同观点"
2. MCP 返回多篇文章的完整内容
3. Claude 自动识别不同观点并进行对比分析
4. Carol 追问:"这些观点中哪个更有数据支撑?"
5. Claude 基于已获取的文章内容深入分析

**预期结果**: 实现多轮对话式分析,无需重复搜索

---

## 4. 非功能性需求

### 4.1 性能要求
- 单次搜索响应时间 < 30 秒(获取 3 篇文章)
- 并发抓取不超过 3 个请求
- 支持异步处理,避免阻塞

### 4.2 可用性要求
- 系统可用性 > 95%
- 当搜狗服务异常时给出明确提示
- 提供详细的错误日志

### 4.3 兼容性要求
- 支持 macOS、Windows、Linux 系统
- 兼容主流 MCP 客户端(Claude for Desktop、Continue 等)
- Python 版本 ≥ 3.8

### 4.4 安全性要求
- 不需要 API Key,无需管理第三方 AI 服务凭证
- 不保存用户搜索历史
- 遵循目标网站的 robots.txt 协议

### 4.5 合规性要求
- 工具仅供个人学习和研究使用
- 始终包含原文链接,尊重版权
- 限制单次请求规模,避免对目标服务器造成负担

---

## 5. 技术约束

### 5.1 技术栈
- **语言**: Python 3.8+
- **框架**: FastMCP (mcp ≥ 1.2.0)
- **HTTP 客户端**: httpx (≥ 0.23.0)
- **HTML 解析**: lxml (≥ 4.9.0)

### 5.2 外部依赖
- 搜狗微信搜索服务
- 微信公众号服务器
- 调用方的 LLM (Claude、GPT、智谱等)

### 5.3 关键风险
- **搜狗反爬升级**: 页面结构变化可能导致解析失败
- **IP 封禁**: 频繁请求可能导致 IP 被封
- **内容长度**: 多篇长文章可能超出某些 LLM 的上下文窗口

---

## 6. 产品设计

### 6.1 工具接口设计

**工具名称**: `search_wechat_articles`

**工具描述**: "搜索微信公众号文章并返回完整内容。返回的内容将由调用的 LLM 根据用户问题进行分析和总结。"

**输入参数**:
- `query` (string, 必填): 搜索关键词或自然语言查询
- `count` (integer, 可选, 默认 3): 获取文章数量,范围 1-10

**输出格式**:
```markdown
# 微信文章搜索结果

**搜索关键词**: [query]
**找到文章数**: [count]

---

## 文章 1: [文章标题]

**公众号**: [公众号名称]  
**链接**: [文章真实URL]

### 正文内容

[文章完整正文内容]

---

## 文章 2: [文章标题]

**公众号**: [公众号名称]  
**链接**: [文章真实URL]

### 正文内容

[文章完整正文内容]

---

[更多文章...]
```

**设计说明**:
- MCP 工具只负责搜索和返回原文,不进行总结
- 调用的 LLM 会自动读取返回的内容并根据用户问题进行分析
- 用户可以进行多轮对话,追问细节,无需重复调用工具

### 6.2 配置参数设计

```python
# 默认获取文章数量
DEFAULT_ARTICLE_COUNT = 3

# 最大获取文章数量
MAX_ARTICLE_COUNT = 10

# 每篇文章的最大字符数(根据 LLM 上下文窗口调整)
MAX_ARTICLE_LENGTH = 10000

# 并发抓取的最大数量
MAX_CONCURRENT_FETCHES = 3

# 请求超时时间(秒)
REQUEST_TIMEOUT = 30

# User-Agent
USER_AGENT = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
```

### 6.3 错误处理设计

**错误类型**:
- `NoResultsError`: 未找到相关文章
- `NetworkError`: 网络请求失败
- `ParseError`: 页面解析失败
- `ContentTooLongError`: 文章内容超长

**错误信息示例**:
- "❌ 未找到相关文章,请尝试其他关键词"
- "❌ 网络连接超时,请稍后重试"
- "❌ 内容解析失败,可能是页面结构已变化"

---

## 7. 开发计划

### 7.1 里程碑

**M1: MVP 版本** (预计 12 小时)
- 实现核心搜索和内容抓取功能
- 完成基本错误处理
- 通过端到端测试

**M2: 优化版本** (预计 1-2 周)
- 添加缓存机制
- 优化性能和稳定性
- 完善文档

**M3: 扩展版本** (预计 1-2 个月)
- 支持时间过滤
- 实现结果排序
- 增加多源搜索

### 7.2 开发阶段

1. **环境搭建** (1h)
2. **微信搜索模块** (4h) - 搜索结果解析和真实链接提取
3. **文章抓取模块** (3h) - 并发抓取和正文解析
4. **MCP Server 集成** (2h)
5. **测试与调优** (2h)

**总计**: 12 小时 (约 1.5 个工作日)

**简化说明**: 移除了关键词提取和总结模块,这些由调用的 LLM 完成

---

## 8. 成功指标

### 8.1 功能指标
- 搜索准确率 > 85% (返回的文章与关键词相关)
- 搜索成功率 > 90% (能返回至少 1 篇文章)
- 内容完整性 > 95% (正文提取准确无遗漏)
- 真实链接获取成功率 > 95%

### 8.2 性能指标
- 平均响应时间 < 25 秒(3篇文章)
- 系统可用性 > 95%
- 并发处理失败率 < 5%

### 8.3 用户指标
- 单用户日均使用次数 > 2
- 用户留存率 > 60% (7 天)
- 用户满意度 > 4/5

---

## 9. 未来规划

### 9.1 短期优化 (1-2 周)
- 结果缓存机制
- 文章质量评分排序
- 请求失败自动重试

### 9.2 中期扩展 (1-2 个月)
- 支持知乎、微博等多源搜索
- 时间范围过滤
- 主题自动分类

### 9.3 长期愿景 (3-6 个月)
- 构建个人知识图谱
- 关键词订阅与推送
- 多模态内容处理(图片、视频)

---

## 10. 附录

### 10.1 参考资料
- Model Context Protocol 官方文档: https://modelcontextprotocol.io/
- fancyboi999/weixin_search_mcp: https://github.com/fancyboi999/weixin_search_mcp
- MCP 最佳实践: 工具应专注数据获取,由 LLM 负责理解和生成

### 10.2 术语表
- **MCP**: Model Context Protocol,一种用于 AI 模型与外部工具交互的协议
- **搜狗微信搜索**: 搜狗提供的微信公众号文章搜索服务
- **异步抓取**: 使用 asyncio 同时处理多个网络请求
- **职责分离**: MCP 负责数据获取,LLM 负责内容理解和生成

### 10.3 变更记录
| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| 1.0 | 2025-11-05 | 初始版本创建 | [待填写] |
| 2.0 | 2025-11-05 | 采用方案一:移除内置总结功能,由调用的 LLM 进行总结 | [待填写] |

---

**文档状态**: ✅ 待评审  
**下一步行动**: 组织产品评审会议,确认需求优先级
