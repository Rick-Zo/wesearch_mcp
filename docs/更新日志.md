# æ›´æ–°æ—¥å¿—

## v1.1.0 - 2025-11-05

### âœ¨ é‡å¤§æ”¹è¿›

#### çœŸå®é“¾æ¥æå–ä¼˜åŒ–
å‚è€ƒå¼€æºé¡¹ç›® [fancyboi999/weixin_search_mcp](https://github.com/fancyboi999/weixin_search_mcp) çš„å®ç°æ–¹æ³•,æˆåŠŸæ”¹è¿›äº†çœŸå®å¾®ä¿¡æ–‡ç« é“¾æ¥çš„æå–é€»è¾‘ã€‚

**æ ¸å¿ƒæ”¹è¿›**:
1. **URLæ‹¼æ¥æå–**: ä»æœç‹—è¿”å›çš„JavaScriptä»£ç ä¸­æå– `url += '...'` ç‰‡æ®µå¹¶æ‹¼æ¥
2. **å­—ç¬¦æ¸…ç†**: ç§»é™¤URLä¸­çš„ç‰¹æ®Šå­—ç¬¦ `@`
3. **å®Œæ•´headers**: æ·»åŠ æ›´å®Œæ•´çš„HTTPè¯·æ±‚å¤´æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨
4. **Refererä¼ é€’**: åœ¨è·å–æ–‡ç« å†…å®¹æ—¶ä¼ é€’æœç‹—é“¾æ¥ä½œä¸ºReferer

**æ•ˆæœå¯¹æ¯”**:

| åŠŸèƒ½ | v1.0 | v1.1 |
|------|------|------|
| æœç´¢åŠŸèƒ½ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ |
| çœŸå®é“¾æ¥è·å– | âŒ å¤±è´¥ | âœ… æˆåŠŸ |
| æ–‡ç« å†…å®¹æŠ“å– | âŒ å¤±è´¥ | âœ… æˆåŠŸ |

### ğŸ“ æŠ€æœ¯ç»†èŠ‚

#### 1. URLæå–é€»è¾‘ (`modules/weixin_search.py`)

```python
# ä»JavaScriptä»£ç ä¸­æå–URLç‰‡æ®µ
start_index = content.find("url += '")
if start_index != -1:
    url_parts = []
    # å¾ªç¯æå–æ‰€æœ‰ url += '...' è¯­å¥
    while True:
        part_start = content.find("url += '", search_start)
        if part_start == -1:
            break
        part_end = content.find("'", part_start + len("url += '"))
        part = content[part_start + len("url += '"):part_end]
        url_parts.append(part)
        search_start = part_end + 1
    
    # æ‹¼æ¥å¹¶æ¸…ç†
    full_url = ''.join(url_parts).replace("@", "")
    if not full_url.startswith('http'):
        real_url = "https://mp." + full_url
```

#### 2. å¢å¼ºçš„è¯·æ±‚å¤´

```python
headers = {
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",
    "Accept-Language": "zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6",
    "Cache-Control": "no-cache",
    "Connection": "keep-alive",
    "Pragma": "no-cache",
    "Referer": f"https://weixin.sogou.com/weixin?query={quote(query)}"
}
```

#### 3. Refereré“¾è·¯è¿½è¸ª

```python
# æœç´¢æ—¶ä¿å­˜æœç‹—é“¾æ¥
results.append({
    'url': final_url,
    'sogou_url': sogou_url,  # ä¿å­˜æœç‹—é“¾æ¥
    ...
})

# æŠ“å–æ–‡ç« æ—¶ä¼ é€’Referer
referer = article.get('sogou_url', '')
content = await ArticleProcessor._fetch_single(article['url'], referer=referer)
```

### ğŸ§ª æµ‹è¯•ç»“æœ

**æµ‹è¯•ç”¨ä¾‹ 1**: æœç´¢"äººå·¥æ™ºèƒ½"
- âœ… æˆåŠŸè·å–çœŸå®é“¾æ¥
- âœ… æˆåŠŸæŠ“å–æ–‡ç« å†…å®¹
- æ–‡ç« 1: 4027å­—ç¬¦
- æ–‡ç« 2: 10014å­—ç¬¦

**æµ‹è¯•ç”¨ä¾‹ 2**: æœç´¢"claude mcp"
- âœ… æˆåŠŸè·å–çœŸå®é“¾æ¥
- âœ… æˆåŠŸæŠ“å–æ–‡ç« å†…å®¹

### ğŸ™ è‡´è°¢

æ„Ÿè°¢å¼€æºé¡¹ç›® [fancyboi999/weixin_search_mcp](https://github.com/fancyboi999/weixin_search_mcp) æä¾›çš„å®ç°æ€è·¯å’ŒæŠ€æœ¯å‚è€ƒã€‚

---

## v1.0.0 - 2025-11-05

### ğŸ‰ é¦–æ¬¡å‘å¸ƒ

- âœ… å¾®ä¿¡æ–‡ç« æœç´¢åŠŸèƒ½
- âœ… æ–‡ç« å…ƒæ•°æ®æå–(æ ‡é¢˜ã€å…¬ä¼—å·ã€æ‘˜è¦)
- âœ… æœç‹—é“¾æ¥è·å–
- âœ… MCP å·¥å…·é›†æˆ
- âœ… Claude Code é…ç½®æ”¯æŒ
- âœ… å¼‚æ­¥å¹¶å‘å¤„ç†
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶

### âš ï¸ å·²çŸ¥é™åˆ¶

- æ–‡ç« å†…å®¹æŠ“å–æˆåŠŸç‡è¾ƒä½(v1.1å·²ä¿®å¤)
- çœŸå®é“¾æ¥æå–å¤±è´¥(v1.1å·²ä¿®å¤)
